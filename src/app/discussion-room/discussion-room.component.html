<app-header-user></app-header-user>
<img
  src="../../assets/images/social_1.jpg"
  class="w-5/6 m-auto opacity-80"
  alt="banner"
/>
<div class="rounded-xl bg-white p-6 ring ring-indigo-50 sm:p-8 w-90 m-8">
  <table
    style="width: 100%; height: 50%"
    (dragover)="dragOver($event)"
    (dragleave)="dragLeave($event)"
    (drop)="drop($event)"
  >
    <tr *ngIf="this.is_dragging_file">
      <td colspan="3" class="bg-red-200">
        <a
          class="group relative flex h-48 items-end rounded-3xl border-4 border-black bg-white transition hover:bg-yellow-50"
        >
          <span
            class="absolute inset-0 -z-10 -translate-x-2 -translate-y-2 rounded-3xl bg-white ring-4 ring-black"
          ></span>

          <div class="p-8">
            <!--<a href="https://www.flaticon.com/free-animated-icons/add-file" title="add file animated icons">Add file animated icons created by Freepik - Flaticon</a>-->
            <img
              class="h-50"
              src="../../assets/GIFs/add-file.gif"
              alt="add-file.gif"
            />
            <p class="text-lg font-bold">
              Drag and drop a file to upload and share on this board!
            </p>
          </div>
        </a>
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <select [(ngModel)]="selected_dr_id" (change)="changeRoom()">
          <option *ngFor="let rm of this.discussion_room_list" [value]="rm.id">
            {{ rm.fromPostal }}XXX to {{ rm.toPostal }}XXX
          </option>
        </select>
      </td>
    </tr>
    <tr *ngFor="let msg of this.message_list">
      <article class="flex bg-white transition hover:shadow-xl">
        <div class="rotate-180 p-2 [writing-mode:_vertical-lr]">
          {{ msg.date }}
          <!-- <time
      datetime="2022-10-10"
      class="flex items-center justify-between gap-4 text-xs font-bold uppercase text-gray-900"
    >
      <span>2022</span>
      <span class="w-px flex-1 bg-gray-900/10"></span>
      <span>Oct 10</span>
    </time> -->
        </div>

        <div class="hidden sm:block sm:basis-56">
          <ng-template [ngIf]="msg.fileMessage" [ngIfElse]="defaultPic">
            <p>@{{ msg.customer.username }} uploaded:</p>
            <img
              src="http://localhost:8080/discussion-message-uploads/{{
                msg.fileMessage
              }}"
            />
          </ng-template>
          <ng-template #defaultPic>
            <!--<a href="https://www.flaticon.com/free-animated-icons/car" title="car animated icons">Car animated icons created by Freepik - Flaticon</a>-->
            <img
              alt="Guitar"
              src="../../assets/GIFs/car.gif"
              class="aspect-square h-80 object-cover"
            />
          </ng-template>
        </div>

        <div class="flex flex-1 flex-col justify-between">
          <div
            class="border-l border-gray-900/10 p-4 sm:border-l-transparent sm:p-6"
          >
            <a href="#">
              <h3 class="font-bold uppercase text-gray-900">
                @{{ msg.customer.username }} says hi!
              </h3>
            </a>

            <p class="mt-2 text-sm text-gray-700" *ngIf="msg.message">
              Message: <br />
              {{ msg.message }}
            </p>
          </div>
        </div>
      </article>
    </tr>
    <tr
      *ngIf="
        this.current_page == this.total_message_pages.length ||
        this.total_message_pages.length == 0
      "
    >
      <td colspan="2">
        <article
          class="flex bg-white transition hover:shadow-xl dark:bg-gray-500 dark:shadow-gray-800/25"
        >
          <div class="hidden sm:block sm:basis-56">
            <small
              >Users currently online:
              <button
                class="group relative inline-block overflow-hidden border border-red-700 px-6 py-2 focus:outline-none focus:ring m-3"
                *ngFor="let i of this.users_online; last as last"
              >
                <span
                  class="absolute inset-x-0 bottom-0 h-[2px] bg-red-600 transition-all group-hover:h-full group-active:bg-red-500"
                ></span>

                <span
                  class="relative text-sm font-medium text-red-600 transition-colors group-hover:text-white"
                >
                  @{{ i }}
                </span>
              </button>
            </small>
          </div>

          <div class="flex flex-1 flex-col justify-between bg-slate-300">
            <div
              class="border-l border-gray-900/10 p-4 dark:border-white/10 sm:!border-l-transparent sm:p-6"
            >
              <h3 class="font-bold uppercase text-gray-900 dark:text-white">
                Your message here:
              </h3>
              <textarea
                [(ngModel)]="new_message"
                class="w-full rounded-lg border-gray-200 p-3 text-sm"
                placeholder="Message"
                rows="8"
              ></textarea>
            </div>

            <div class="sm:flex sm:items-end sm:justify-end">
              <!--<a href="https://www.flaticon.com/free-animated-icons/email" title="email animated icons">Email animated icons created by Freepik - Flaticon</a>-->

              <button
                class="block bg-yellow-400 px-5 py-3 text-center text-xs font-bold uppercase text-gray-900 transition hover:bg-yellow-500 m-5 rounded-full"
                (click)="sendMessage()"
              >
                <img
                  class="h-7"
                  src="../../assets/images/email.png"
                  alt="email-logo"
                />
                Post Message
              </button>
            </div>
          </div>
        </article>
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <div style="width: fit-content; margin: auto">
          <div class="pagination">
            <a
              class="inline-block rounded-full border border-red-700 p-3 text-red-600 hover:bg-red-600 hover:text-white focus:outline-none focus:ring active:bg-red-500"
              *ngIf="this.current_page > 1"
              (click)="changePage(this.current_page - 1)"
              >&laquo;</a
            >

            <a
              class="inline-block rounded-full border border-red-700 p-3 text-red-600 hover:bg-red-600 hover:text-white focus:outline-none focus:ring active:bg-red-500"
              *ngFor="let p of this.total_message_pages"
              [class.active]="p == this.current_page"
              (click)="p != this.current_page ? changePage(p) : null"
            >
              {{ p }}
            </a>

            <a
              class="inline-block rounded-full border border-red-700 p-3 text-red-600 hover:bg-red-600 hover:text-white focus:outline-none focus:ring active:bg-red-500"
              *ngIf="this.current_page < this.total_message_pages.length"
              (click)="changePage(this.current_page + 1)"
              >&raquo;</a
            >
          </div>
        </div>
      </td>
    </tr>
  </table>
</div>
